<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>备案信息查询系统</title>
    <!-- 使用指定镜像站引入Element Plus样式 -->
    <link rel="stylesheet" href="https://npm.elemecdn.com/element-plus/dist/index.css">
    <!-- 使用指定镜像站引入Vue -->
    <script src="https://registry.npmmirror.com/vue/3.5.22/files/dist/vue.global.js"></script>
    <!-- 使用指定镜像站引入Element Plus -->
    <script src="https://npm.elemecdn.com/element-plus"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
        }
        .header h1 {
            color: #409EFF;
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.1);
        }
        .header p {
            color: #666;
            font-size: 1.1rem;
        }
        .query-card {
            margin-bottom: 30px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            border-radius: 12px;
            overflow: hidden;
        }
        .result-card {
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            border-radius: 12px;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        .result-card.success {
            border-left: 4px solid #67C23A;
        }
        .result-card.error {
            border-left: 4px solid #F56C6C;
        }
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .info-item {
            display: flex;
            flex-direction: column;
            padding: 10px;
            background: #f9f9f9;
            border-radius: 8px;
        }
        .info-label {
            font-weight: bold;
            color: #606266;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }
        .info-value {
            color: #303133;
            font-size: 1.1rem;
            word-break: break-all;
        }
        .footer {
            text-align: center;
            margin-top: 40px;
            color: #909399;
            font-size: 0.9rem;
        }
        .example-text {
            font-size: 0.85rem;
            color: #909399;
            margin-top: 8px;
        }
        .history-list {
            margin-top: 20px;
        }
        .history-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #ebeef5;
            cursor: pointer;
        }
        .history-item:hover {
            background-color: #f5f7fa;
        }
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            .info-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
<div id="app">
    <div class="container">
        <div class="header">
            <h1>备案信息查询</h1>
        </div>
        <el-card class="query-card">
            <template #header>
                <div style="display: flex; align-items: center;">
                    <span>备案信息查询</span>
                </div>
            </template>

            <div style="display: flex; gap: 10px; align-items: center;">
                <el-input
                        v-model="domain"
                        placeholder="请输入域名，例如：baidu.com"
                        size="large"
                        @keyup.enter="queryRecord"
                        clearable>
                </el-input>
                <el-button
                        type="primary"
                        size="large"
                        @click="queryRecord"
                        :loading="loading"
                >
                    <el-icon style="margin-right: 5px;"><Search /></el-icon>
                    查询
                </el-button>
            </div>
            <div class="example-text">示例：baidu.com、qq.com、taobao.com</div>

            <div class="history-list" v-if="queryHistory.length > 0">
                <div style="margin: 15px 0 10px; font-weight: bold; color: #606266;">查询历史</div>
                <div
                        v-for="(item, index) in queryHistory"
                        :key="index"
                        class="history-item"
                        @click="selectHistory(item)"
                >
                    <span>{{ item }}</span>
                    <el-icon @click.stop="removeHistory(index)"><Close /></el-icon>
                </div>
            </div>
        </el-card>
        <el-card class="result-card" :class="resultClass" v-if="showResult">
            <template #header>
                <div style="display: flex; align-items: center; justify-content: space-between;">
                    <div style="display: flex; align-items: center;">
                        <el-icon style="margin-right: 10px;" :color="resultIconColor">
                            <component :is="resultIcon" />
                        </el-icon>
                        <span>查询结果</span>
                    </div>
                    <el-button
                            type="primary"
                            text
                            @click="exportResult"
                            v-if="result.code === '200'">
                        <el-icon style="margin-right: 5px;"><Download /></el-icon>
                        导出结果
                    </el-button>
                </div>
            </template>

            <div v-if="result.code === '200'">
                <div class="info-grid">
                    <div class="info-item">
                        <span class="info-label">域名</span>
                        <span class="info-value">{{ result.domain }}</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">备案号</span>
                        <span class="info-value">{{ result.serviceLicence }}</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">单位名称</span>
                        <span class="info-value">{{ result.unitName }}</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">单位性质</span>
                        <span class="info-value">{{ result.natureName }}</span>
                    </div>
                </div>
            </div>
            <div v-else>
                <el-alert
                        :title="result.msg || '查询失败'"
                        type="error"
                        show-icon
                        :closable="false"
                />
            </div>
        </el-card>
    </div>
</div>

<script>
    const { createApp, ref, computed, onMounted } = Vue;
    const { ElCard, ElInput, ElButton, ElIcon, ElAlert, ElMessage } = ElementPlus;
    const Search = {template: `<svg viewBox="0 0 1024 1024" width="1em" height="1em"><path d="M909.6 854.5L649.9 594.8C690.2 542.7 712 479 712 412c0-80.2-31.3-155.4-87.9-212.1c-56.6-56.7-132-87.9-212.1-87.9s-155.5 31.3-212.1 87.9C143.2 256.5 112 331.8 112 412c0 80.1 31.3 155.5 87.9 212.1C256.5 680.8 331.8 712 412 712c67 0 130.6-21.8 182.7-62l259.7 259.6a8.2 8.2 0 0 0 11.6 0l43.6-43.5a8.2 8.2 0 0 0 0-11.6zM570.4 570.4C528 612.7 471.8 636 412 636s-116-23.3-158.4-65.6C211.3 528 188 471.8 188 412s23.3-116.1 65.6-158.4C296 211.3 352.2 188 412 188s116.1 23.2 158.4 65.6S636 352.2 636 412s-23.3 116.1-65.6 158.4z" fill="currentColor"></path></svg>`};
    const SuccessFilled = {template: `<svg viewBox="0 0 1024 1024" width="1em" height="1em"><path d="M512 64a448 448 0 1 1 0 896a448 448 0 0 1 0-896zm-55.808 536.384l-99.52-99.584a38.4 38.4 0 0 0-54.336 0a38.4 38.4 0 0 0 0 54.336l126.72 126.72a38.272 38.272 0 0 0 54.336 0l262.4-262.464a38.4 38.4 0 0 0 0-54.272a38.4 38.4 0 0 0-54.304 0L456.192 600.384z" fill="currentColor"></path></svg>`};
    const WarningFilled = {template: `<svg viewBox="0 0 1024 1024" width="1em" height="1em"><path d="M512 64a448 448 0 1 1 0 896a448 448 0 0 1 0-896zm0 192a58.432 58.432 0 0 0-58.24 63.744l23.36 256.384a35.072 35.072 0 0 0 69.76 0l23.296-256.384A58.432 58.432 0 0 0 512 256zm0 512a51.2 51.2 0 1 0 0-102.4a51.2 51.2 0 0 0 0 102.4z" fill="currentColor"></path></svg>`};
    const Close = {template: `<svg viewBox="0 0 1024 1024" width="1em" height="1em"><path d="M563.8 512l262.5-312.9c4.4-5.2.7-13.1-6.1-13.1h-79.8c-4.7 0-9.2 2.1-12.3 5.7L511.6 449.8 295.1 191.7c-3-3.6-7.5-5.7-12.3-5.7H203c-6.8 0-10.5 7.9-6.1 13.1L459.4 512 196.9 824.9A7.95 7.95 0 0 0 203 838h79.8c4.7 0 9.2-2.1 12.3-5.7l216.5-258.1 216.5 258.1c3 3.6 7.5 5.7 12.3 5.7h79.8c6.8 0 10.5-7.9 6.1-13.1L563.8 512z" fill="currentColor"></path></svg>`};
    const Download = {template: `<svg viewBox="0 0 1024 1024" width="1em" height="1em"><path d="M505.7 661a8 8 0 0 0 12.6 0l112-141.7c4.1-5.2.4-12.9-6.3-12.9h-74.1V168c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v338.3H400c-6.7 0-10.4 7.7-6.3 12.9l112 141.8zM878 626h-60c-4.4 0-8 3.6-8 8v154H214V634c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v198c0 17.7 14.3 32 32 32h684c17.7 0 32-14.3 32-32V634c0-4.4-3.6-8-8-8z" fill="currentColor"></path></svg>`};
    createApp({
        components: {
            ElCard, ElInput, ElButton, ElIcon, ElAlert, Search, SuccessFilled, WarningFilled, Close, Download
        },
        setup() {
            const domain = ref('');
            const loading = ref(false);
            const showResult = ref(false);
            const result = ref({});
            const queryHistory = ref([]);
            const loadHistory = () => {
                const history = localStorage.getItem('icpQueryHistory');
                if (history) {
                    queryHistory.value = JSON.parse(history);
                }
            };
            const saveHistory = () => {
                localStorage.setItem('icpQueryHistory', JSON.stringify(queryHistory.value));
            };
            const addToHistory = (domain) => {
                if (!queryHistory.value.includes(domain)) {
                    queryHistory.value.unshift(domain);
                    if (queryHistory.value.length > 10) {
                        queryHistory.value = queryHistory.value.slice(0, 10);
                    }
                    saveHistory();
                }
            };
            const removeHistory = (index) => {
                queryHistory.value.splice(index, 1);
                saveHistory();
            };
            const selectHistory = (historyDomain) => {
                domain.value = historyDomain;
                queryRecord();
            };

            //######API部分#######
            const queryRecord = async () => {
                if (!domain.value.trim()) {
                    ElMessage.error('请输入域名');
                    return;
                }
                const domainRegex = /^[a-zA-Z0-9][a-zA-Z0-9-]{1,61}[a-zA-Z0-9]\.[a-zA-Z]{2,}$/;
                if (!domainRegex.test(domain.value)) {
                    ElMessage.error('请输入正确的域名格式');
                    return;
                }
                loading.value = true;
                showResult.value = false;

                try {
                    const apiUrl = `https://uapis-proxy.qiqinb.cn/api/v1/network/icp?domain=${domain.value}`;
                    const response = await fetch(apiUrl);
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    result.value = await response.json();
                    if (result.value.code === '200') {
                        addToHistory(domain.value);
                    }
                    showResult.value = true;
                } catch (error) {
                    console.error('API调用失败:', error);
                    ElMessage.error('查询失败，请检查网络连接或稍后重试');
                } finally {
                    loading.value = false;
                }
            };
            const exportResult = () => {
                if (result.value.code !== '200') return;

                const content = `
备案信息查询结果
================

域名: ${result.value.domain}
备案号: ${result.value.serviceLicence}
单位名称: ${result.value.unitName}
单位性质: ${result.value.natureName}
查询时间: ${new Date().toLocaleString()}
                    `.trim();
                const blob = new Blob([content], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `备案信息-${result.value.domain}.txt`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                ElMessage.success('结果已导出');
            };
            const resultClass = computed(() => {return result.value.code === '200' ? 'success' : 'error';});
            const resultIcon = computed(() => {return result.value.code === '200' ? 'SuccessFilled' : 'WarningFilled';});
            const resultIconColor = computed(() => {return result.value.code === '200' ? '#67C23A' : '#F56C6C';});
            onMounted(() => {loadHistory();});
            return {
                domain, loading, showResult, result, queryHistory, queryRecord, removeHistory, selectHistory, exportResult, resultClass, resultIcon, resultIconColor
            };
        }
    }).use(ElementPlus).mount('#app');
</script>
</body>
</html>